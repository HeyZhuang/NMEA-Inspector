### 一、整体架构与技术栈

- **框架**：Qt（跨平台 GUI，用 C++ 开发，适配串口通信、图形绘制）。
- **核心能力**：串口通信（读 GNSS NMEA 数据）、数据解析（NMEA 语句转结构化信息）、多图表渲染（卫星雷达图、偏差图、信噪比柱状图）、数据展示与交互（状态面板、控制按钮）。

### 二、模块拆分与开发步骤

#### 1. 串口通信模块

- **功能**：打开 / 关闭串口、配置参数（串口号、波特率、数据位、停止位、校验位）、实时读取 NMEA 数据。

- 技术实现

  ：

  - 用 Qt 的`QSerialPort`类封装串口操作，提供 “刷新串口”“连接串口”“断开连接” 等接口。
  - 配置参数通过 Qt 控件（下拉框、按钮）与`QSerialPort`的`setPortName`、`setBaudRate`等方法绑定。
  - 数据读取：开启串口后，通过`readyRead`信号触发读取，将字节流转为字符串（NMEA 为 ASCII 文本格式）。

#### 2. NMEA 数据解析模块

- **功能**：将串口读取的 NMEA 字符串解析为 “卫星信息”“定位状态”“经纬度” 等结构化数据。

- 技术实现

  ：

  - 按 NMEA 语句类型（如`$GPGGA`、`$GPRMC`等）分类，用字符串分割（`QString::split(",")`）提取字段。
  - 示例：解析`$GPGGA`语句时，第 2 字段是时间、第 3/4 字段是纬度 / 南北半球、第 5/6 字段是经度 / 东西半球，需将这些字段转为数值并存储。
  - 输出：解析后的数据存入自定义结构体（如`GNSSData`，包含卫星 ID、信噪比、经纬度、系统状态等字段）。

#### 3. 图形渲染模块（核心可视化）

需实现**卫星雷达图**、**偏差图**、**信噪比柱状图**三类图表，可借助 Qt 的`QCustomPlot`（第三方绘图库，轻量且易集成）或 Qt 自带的`QChart`模块。

##### （1）卫星雷达图

- **功能**：按方位角、卫星 ID 展示卫星分布，用不同颜色 / 大小区分卫星类型（GPS、北斗等）或信号质量。

- 实现逻辑

  ：

  - 雷达图以圆心为原点，极角表示卫星方位角，极径表示卫星高度角（或信号强度）。
  - 解析出卫星 ID、方位角、高度角后，在极坐标下绘制 “卫星点”（用`QCPCurve`或`QChart`的极坐标图表）。
  - 交互：鼠标 hover 卫星点时，显示卫星详细信息（如 ID、信噪比）。

##### （2）偏差图（Deviation Map）

- **功能**：展示定位偏差（如与基准点的位置偏差），用点、线或热力图呈现。

- 实现逻辑

  ：

  - 若为 “轨迹偏差”，需记录历史定位点与基准点的坐标差，绘制偏差曲线。
  - 若为 “区域偏差分布”，可将偏差值映射为颜色，绘制热力图（需额外处理网格与颜色映射）。

##### （3）信噪比柱状图

- **功能**：按卫星 ID 展示信噪比（SNR），直观对比不同卫星的信号质量。

- 实现逻辑

  ：

  - X 轴为卫星 ID（或分组，如 GPS_B1、北斗_B2A），Y 轴为信噪比数值。
  - 解析出卫星 ID 与对应 SNR 后，用`QBarSeries`（`QChart`）或`QCustomPlot`的柱状图组件绘制。

#### 4. 数据展示与交互模块

- **状态面板**：右侧展示 “系统（北斗）”“卫星数”“状态（固定解）”“PDOP”“经纬度” 等信息，用`QLabel`或`QTableWidget`绑定解析后的数据字段。

- 控制与辅助功能

  ：

  - “保存数据”：将解析后的 GNSS 数据写入本地文件（如 CSV）。
  - “清空接收”：重置串口读取缓存与界面数据显示。
  - “加载离线文件”“回放电数据”：读取历史 NMEA 文件，模拟实时串口数据进行界面重绘。
  - “读取速度条”“Start 按钮”：控制数据读取速率或启动 / 停止数据解析渲染。

### 三、开发流程建议

1. **先做基础功能验证**：
   - 完成串口通信（能读取 NMEA 字符串并打印）。
   - 实现单类 NMEA 语句解析（如`$GPGGA`），并在控制台输出结构化数据。
2. **逐步集成可视化**：
   - 先实现简单的 “信噪比柱状图”（用固定测试数据，验证绘图逻辑）。
   - 再扩展卫星雷达图、偏差图，接入解析后的真实数据。
3. **完善交互与异常处理**：
   - 处理串口断开、数据格式错误等异常情况（如弹窗提示、自动重连）。
   - 优化界面布局与响应速度（如数据量大时用多线程解析，避免 UI 卡顿）。

### 四、向 Cursor 提需求的示例话术

（将上述模块拆分为 Prompt，分阶段引导 Cursor 生成代码）

#### Prompt 1：串口通信与基础架构

> 用 Qt（C++）开发一个 GNSS 数据可视化软件，首先实现串口通信模块。要求：
>
> - 界面左侧有 “串口号、波特率、数据位、停止位、校验位” 的配置控件，以及 “刷新串口、连接串口、断开连接” 按钮。
> - 用`QSerialPort`类，实现串口参数配置与数据读取，读取到的 NMEA 字符串打印到控制台。

#### Prompt 2：NMEA 解析（以 $GPGGA 为例）

> 基于上一步的串口通信，解析 NMEA 的`$GPGGA`语句。要求：
>
> - 提取时间、纬度、经度、卫星数、信噪比等字段，存入自定义结构体`GNSSData`。
> - 打印解析后的结构体内容，验证字段提取正确性。

#### Prompt 3：信噪比柱状图渲染

> 基于解析后的`GNSSData`（含卫星 ID 与信噪比），绘制信噪比柱状图。要求：
>
> - 使用 Qt 的`QChart`模块，X 轴为卫星 ID，Y 轴为信噪比。
> - 柱状图颜色为红色，支持鼠标 hover 显示详细数值。

#### Prompt 4：卫星雷达图渲染

> 实现 GNSS 卫星雷达图，要求：
>
> - 极坐标展示，极角为卫星方位角，极径为高度角（或信噪比）。
> - 不同卫星系统（GPS、北斗）用不同颜色标记，点击卫星点显示 ID 与 SNR。